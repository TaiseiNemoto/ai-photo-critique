# AI課題修正時の必須コンテキスト

## 必須ドキュメント参照

- **開発ルール**: `CLAUDE.md` (コーディングガイドライン・TDD手法)

## 修正時の必須ルール

### ✅ 実装前チェック

- [ ] 課題IDと優先度を確認 (C1/C2/H1等)
- [ ] 関連課題の依存関係をチェック
- [ ] 関連ファイルを事前調査
- [ ] 既存テストを確認・実行
- [ ] **修正計画を立ててユーザーに提示・承認を得る**
- [ ] **修正計画をdocs/fixesフォルダにドキュメント化する**

### ✅ TDD実装ルール

- [ ] **承認された計画に沿って修正を進める**
- [ ] **Red**: 失敗するテストを先に作成
- [ ] **Green**: 最小限の実装でテスト通過
- [ ] **Refactor**: 品質改善・コード整理
- [ ] 境界値・異常系のテストも追加

### ✅ 修正完了時の確認

- [ ] `npm run test` 全通過
- [ ] `npm run lint` エラーなし
- [ ] `npm run build` 成功
- [ ] 画像アップロード〜講評生成の動作確認
- [ ] 処理時間・メモリ使用量の改善確認

## 修正禁止事項

- 既存UIの大幅変更
- KVストレージ構造の無断変更
- 外部API仕様の変更
- テスト削除・スキップ
- 型安全性を損なう修正

## 期待する成果物

1. 修正されたソースコード
2. 追加・修正されたテストコード
3. 修正内容の簡潔な説明
4. **修正計画ドキュメント** (`docs/fixes/{課題ID}_{説明}.md`形式)

## 📋 修正計画ドキュメント化ルール

### 必須ファイル作成

**場所**: `docs/fixes/`フォルダ内  
**命名規則**: `{課題ID}_{課題概要}.md`  
**例**: `C2_server_actions_api_routes_antipattern.md`

### ドキュメント必須内容

1. **課題概要** - 問題の詳細と影響範囲
2. **修正方針** - Next.js等のベストプラクティスに基づく方針
3. **具体的な修正内容** - ファイル別の変更詳細
4. **実装手順** - TDD方式での段階的実装
5. **期待効果** - パフォーマンス・型安全性等の改善
6. **影響範囲** - 修正・削除・新規作成ファイル一覧
7. **完了定義** - テスト通過・ビルド成功等の条件

### テンプレート参考

`docs/fixes/C2_server_actions_api_routes_antipattern.md`を参考にして、同様の構造で作成すること。
