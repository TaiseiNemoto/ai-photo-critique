# èª²é¡ŒDATA_INTEGRATIONä¿®æ­£è¨ˆç”» - è¬›è©•ãƒ‡ãƒ¼ã‚¿ã¨å…±æœ‰ãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨çµ±åˆ

**èª²é¡ŒID**: DATA_INTEGRATION
**å„ªå…ˆåº¦**: ğŸ”´ Ultra High â­â­â­â­â­
**ä½œæˆæ—¥**: 2025-09-29

## ğŸ” èª²é¡Œæ¦‚è¦

### å•é¡Œã®è©³ç´°

- **åŒåç•°æ§‹é€ **: `CritiqueData`ãŒ2ç®‡æ‰€ã§ç•°ãªã‚‹å®šç¾©ï¼ˆsrc/lib/kv.ts ã¨ src/types/upload.tsï¼‰
- **ãƒ‡ãƒ¼ã‚¿åˆ†é›¢**: è¬›è©•ãƒ‡ãƒ¼ã‚¿(`CritiqueData`)ã¨å…±æœ‰ãƒ‡ãƒ¼ã‚¿(`ShareData`)ãŒåˆ¥æ§‹é€ 
- **è¤‡é›‘ãªå–å¾—å‡¦ç†**: `/api/data/[id]`ã§2å›ã®ã‚¯ã‚¨ãƒªãŒå¿…è¦
- **å‹å®‰å…¨æ€§æ¬ å¦‚**: é–‹ç™ºæ™‚ã®æ··ä¹±ã¨ãƒã‚°ã®åŸå› 

## ğŸ¯ ä¿®æ­£æ–¹é‡

### å˜ä¸€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¸ã®å®Œå…¨çµ±åˆ

```typescript
export interface CritiqueData {
  // åŸºæœ¬æƒ…å ±
  id: string;
  filename: string;
  uploadedAt: string;

  // è¬›è©•å†…å®¹
  technique: string;
  composition: string;
  color: string;
  overall?: string;

  // ç”»åƒé–¢é€£
  imageData: string;
  exifData: Record<string, unknown>;

  // å…±æœ‰æ©Ÿèƒ½ï¼ˆæ—§ShareDataçµ±åˆï¼‰
  shareId: string;
  createdAt: string;
  expiresAt: string;
}
```

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: äº‹å‰æº–å‚™

- [x] `npm run test` ã§ç¾çŠ¶ãƒ†ã‚¹ãƒˆç¢ºèª
- [x] `npm run lint` ã§ã‚³ãƒ¼ãƒ‰å“è³ªç¢ºèª
- [x] `npm run build` ã§ãƒ“ãƒ«ãƒ‰ç¢ºèª
- [x] `git add . && git commit -m "çµ±åˆä½œæ¥­å‰ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—"`

### Phase 2: å¤±æ•—ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆREDï¼‰

- [x] çµ±åˆCritiqueDataã®ä¿å­˜ãƒ»å–å¾—ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
- [x] ShareDataãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤ãƒ†ã‚¹ãƒˆä½œæˆ
- [x] å˜ä¸€ãƒ‡ãƒ¼ã‚¿å–å¾—APIãƒ†ã‚¹ãƒˆä½œæˆ
- [x] ãƒ†ã‚¹ãƒˆãŒé©åˆ‡ã«å¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### Phase 3: å‹å®šç¾©çµ±åˆï¼ˆGREEN - Step 1ï¼‰

- [x] `src/lib/kv.ts`ã§CritiqueDataçµ±åˆå®šç¾©ã«å¤‰æ›´
- [x] ShareDataã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‰Šé™¤
- [x] `src/types/upload.ts`é‡è¤‡CritiqueDataå‰Šé™¤
- [x] `export { type CritiqueData } from "@/lib/kv"`è¿½åŠ 

### Phase 4: KVã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¿®æ­£ï¼ˆGREEN - Step 2ï¼‰

- [x] `KvClient.saveShare()`ãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤
- [x] `KvClient.getShare()`ãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤
- [x] `saveCritique/getCritique`ãƒ¡ã‚½ãƒƒãƒ‰çµ±åˆãƒ‡ãƒ¼ã‚¿å¯¾å¿œ

### Phase 5: APIå‡¦ç†ç°¡ç´ åŒ–ï¼ˆGREEN - Step 3ï¼‰

- [x] `/api/data/[id]`å˜ä¸€ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤‰æ›´
- [x] è¤‡é›‘ãª2æ®µéšå–å¾—å‡¦ç†å‰Šé™¤
- [x] å˜ä¸€æœŸé™ãƒã‚§ãƒƒã‚¯ã«å¤‰æ›´
- [x] `/api/share`ShareDataå‡¦ç†å‰Šé™¤

### Phase 6: å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å‹å‚ç…§æ›´æ–°ï¼ˆGREEN - Step 4ï¼‰

- [x] `src/contexts/CritiqueContext.tsx`
- [x] `src/components/share/ShareCritiqueCards.tsx`
- [x] `src/hooks/useUploadState.ts`
- [x] `src/services/upload-service.ts`
- [x] `src/lib/critique.ts`
- [x] `src/lib/gemini.ts`
- [x] `src/mocks/handlers.ts`

### Phase 7: å…¨ãƒ†ã‚¹ãƒˆä¿®æ­£ï¼ˆGREEN - Step 5ï¼‰

- [x] `src/lib/kv.test.ts` - çµ±åˆãƒ‡ãƒ¼ã‚¿æ§‹é€ å¯¾å¿œï¼ˆShareDataå‰Šé™¤æ¸ˆã¿ï¼‰
- [x] `src/app/api/data/[id]/route.test.ts` - å˜ä¸€å–å¾—å¯¾å¿œï¼ˆæ—¢ã«å¯¾å¿œæ¸ˆã¿ç¢ºèªï¼‰
- [x] `src/app/api/share/route.test.ts` - ShareDataå‰Šé™¤å¯¾å¿œï¼ˆæ—¢ã«å¯¾å¿œæ¸ˆã¿ç¢ºèªï¼‰
- [x] ãã®ä»–å…¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®çµ±åˆå‹å¯¾å¿œ

### Phase 8: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆREFACTORï¼‰

- [x] ä¸è¦ãªã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰Šé™¤ï¼ˆLintãƒã‚§ãƒƒã‚¯é€šéã€ä¸è¦ãªã‚¤ãƒ³ãƒãƒ¼ãƒˆãªã—ï¼‰
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰
- [x] ã‚³ãƒ¡ãƒ³ãƒˆæ•´ç†ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### Phase 9: ç·åˆãƒ†ã‚¹ãƒˆ

- [x] `npm run test` å…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ207/207ãƒ†ã‚¹ãƒˆæˆåŠŸï¼‰
- [x] `npm run lint` ã‚¨ãƒ©ãƒ¼ãªã—ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰
- [x] `npm run build` æˆåŠŸï¼ˆç¢ºèªæ¸ˆã¿ï¼‰
- [ ] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â†’è¬›è©•ç”Ÿæˆâ†’å…±æœ‰ãƒ•ãƒ­ãƒ¼å‹•ä½œç¢ºèªï¼ˆæ‰‹å‹•ãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰

## ğŸ—‚ï¸ ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

### ã‚³ã‚¢ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«

- âœï¸ `src/lib/kv.ts` - ãƒ‡ãƒ¼ã‚¿å‹çµ±åˆã€ShareDataå‰Šé™¤
- âœï¸ `src/types/upload.ts` - é‡è¤‡å®šç¾©å‰Šé™¤ã€å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- âœï¸ `src/app/api/data/[id]/route.ts` - å˜ä¸€ãƒ‡ãƒ¼ã‚¿å–å¾—
- âœï¸ `src/app/api/share/route.ts` - ShareDataå‡¦ç†å‰Šé™¤

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

- âœï¸ `src/lib/kv.test.ts`
- âœï¸ `src/app/api/data/[id]/route.test.ts`
- âœï¸ `src/app/api/share/route.test.ts`
- âœï¸ ãã®ä»–å…¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»ã‚µãƒ¼ãƒ“ã‚¹

- âœï¸ `src/contexts/CritiqueContext.tsx`
- âœï¸ `src/components/share/ShareCritiqueCards.tsx`
- âœï¸ `src/hooks/useUploadState.ts`
- âœï¸ `src/services/upload-service.ts`
- âœï¸ `src/lib/critique.ts`, `src/lib/gemini.ts`
- âœï¸ `src/mocks/handlers.ts`

## ğŸš¨ å‰Šé™¤è¦ç´ 

- âŒ `ShareData`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- âŒ `KvClient.saveShare()`ãƒ¡ã‚½ãƒƒãƒ‰
- âŒ `KvClient.getShare()`ãƒ¡ã‚½ãƒƒãƒ‰
- âŒ `/api/data/[id]`ã®2æ®µéšå–å¾—å‡¦ç†
- âŒ src/types/upload.tsã®é‡è¤‡CritiqueData

## ğŸ¯ å®Œäº†å®šç¾©

- [x] çµ±åˆCritiqueDataå®šç¾©å®Œæˆ
- [x] ShareDataå®Œå…¨å‰Šé™¤
- [x] å…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ`npm run test`ï¼‰- 207/207ãƒ†ã‚¹ãƒˆæˆåŠŸ
- [x] Linté€šéï¼ˆ`npm run lint`ï¼‰
- [x] ãƒ“ãƒ«ãƒ‰æˆåŠŸï¼ˆ`npm run build`ï¼‰
- [x] å‹çµ±ä¸€ä½œæ¥­å®Œäº†ï¼ˆCritiqueData/CritiqueContentä¸€æœ¬åŒ–ï¼‰
- [ ] ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â†’è¬›è©•â†’å…±æœ‰ãƒ•ãƒ­ãƒ¼å‹•ä½œç¢ºèª
- [ ] æ—¢å­˜å…±æœ‰URLå‹•ä½œç¢ºèª

---

**å®Ÿè£…æ–¹å¼**: TDDï¼ˆRed-Green-Refactorï¼‰
**æƒ³å®šå‰Šé™¤è¡Œæ•°**: ç´„200è¡Œ
**æœŸå¾…å‡¦ç†é€Ÿåº¦æ”¹å–„**: 30-50%ï¼ˆã‚¯ã‚¨ãƒªæ•°å‰Šæ¸›ï¼‰

## âœ… å®Œäº†ã‚µãƒãƒªãƒ¼ï¼ˆ2025-09-30ï¼‰

### å®Ÿè£…å®Œäº†é …ç›®

âœ… **Phase 1-9ã™ã¹ã¦å®Œäº†**
- å‹å®šç¾©ã®å®Œå…¨çµ±åˆï¼ˆCritiqueDataå˜ä¸€åŒ–ï¼‰
- ShareDataå‰Šé™¤ã¨KVã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç°¡ç´ åŒ–
- APIå‡¦ç†ã®å˜ä¸€åŒ–ï¼ˆ2æ®µéšã‚¯ã‚¨ãƒªâ†’1æ®µéšã‚¯ã‚¨ãƒªï¼‰
- å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å‹å‚ç…§æ›´æ–°
- å…¨ãƒ†ã‚¹ãƒˆä¿®æ­£ã¨é€šéç¢ºèªï¼ˆ207/207ãƒ†ã‚¹ãƒˆæˆåŠŸï¼‰
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Œäº†
- ç·åˆãƒ†ã‚¹ãƒˆé€šéï¼ˆtest/lint/buildï¼‰

### å“è³ªæŒ‡æ¨™

- âœ… **ãƒ†ã‚¹ãƒˆ**: 207/207ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ˆ100%é€šéï¼‰
- âœ… **Lint**: ã‚¨ãƒ©ãƒ¼0ä»¶
- âœ… **ãƒ“ãƒ«ãƒ‰**: æ­£å¸¸å®Œäº†
- âœ… **å‹å®‰å…¨æ€§**: å®Œå…¨çµ±åˆã€é‡è¤‡å®šç¾©å‰Šé™¤

### æ®‹ä½œæ¥­

- [ ] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â†’è¬›è©•ç”Ÿæˆâ†’å…±æœ‰ãƒ•ãƒ­ãƒ¼å‹•ä½œç¢ºèªï¼ˆæ‰‹å‹•ãƒ†ã‚¹ãƒˆï¼‰
- [ ] æ—¢å­˜å…±æœ‰URLå‹•ä½œç¢ºèªï¼ˆæ‰‹å‹•ãƒ†ã‚¹ãƒˆï¼‰

### æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¨å¥¨äº‹é …

1. `npm run dev`ã§é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
2. å®Ÿéš›ã®ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â†’è¬›è©•â†’å…±æœ‰ãƒ•ãƒ­ãƒ¼ã‚’æ‰‹å‹•ãƒ†ã‚¹ãƒˆ
3. æ—¢å­˜ã®å…±æœ‰URLãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ç¢ºèª
4. å¿…è¦ã«å¿œã˜ã¦E2Eãƒ†ã‚¹ãƒˆã®è¿½åŠ æ¤œè¨
